---
title: JS引擎之内存机制
date: 2021-1-23
categories:
 - JavaScript
tags:
 - JS引擎
---

我们知道，基础数据类型存储在栈内存，引用数据类型存储在堆内存。

让我们来看看下面这段代码

```js
function foo(){
  var a = 1;
  var b = a;
  var c = {num: 1};
  var d = c;

  a = 2;
  c.num = 2;

  console.log(b);	// 1
  console.log(d);	// {num: 2}
}
foo()
```

+ 在执行foo函数前，JS引擎会创建一个全局执行上下文并推入调用栈（这里的调用栈也就是我们所说的栈内存）
+ 执行 foo 函数，创建函数执行上下文并推入调用栈，然后初始化变量环境
+ 对于基础数据类型，变量的值就是具体的值；而对于引用数据类型， 在创建时会将数据放入堆内存，然后将引用/地址赋值给变量
+ 会有一个ESP指针指向当前执行上下文

![image-20210131155140257](F:\Study_Document\笔记\image\image-20210131155140257.png)

所以在修改引用数据类型时会根据引用找到对应堆内存的值并进行修改，而此时c, d的引用并没有发生改变，还是指向同一块内存。

当foo函数执行完毕时，ESP指向会向下移动，重新指回全局执行上下文，这时foo函数对应的栈空间就会被回收，这也就是栈内存的垃圾回收方式。